Задание 1. Резервное копирование
Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Приведите ответ в свободной форме.



Решение:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

В этом случае подходит вариант полного резервного копирования. Полный резервный копинг создает копию всех данных в базе данных, включая все таблицы, индексы, триггеры и другие структуры. Это обеспечивает максимальную полноту и актуальность данных для восстановления.

Для выполнения полного резервного копирования в финансовом учреждении можно использовать следующие инструменты:

Встроенный инструмент резервного копирования в базе данных. Например, в MySQL можно использовать команду mysqldump для создания полного резервного копирования.
Специальные инструменты резервного копирования. Например, такие инструменты, как Veeam Backup & Replication, Acronis Backup и другие.
1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

В этом случае подходит вариант дифференциального резервного копирования. Дифференциальное резервное копирование создает копию только тех данных, которые были изменены с момента последнего полного или дифференциального резервного копирования.

Для выполнения дифференциального резервного копирования в финансовом учреждении можно использовать следующие инструменты:

Встроенный инструмент резервного копирования в базе данных. Например, в MySQL можно использовать команду mysqldump --incremental-backup для создания дифференциального резервного копирования.
Специальные инструменты резервного копирования. Например, такие инструменты, как Veeam Backup & Replication, Acronis Backup и другие.
Для того чтобы восстановить данные за час до предполагаемой поломки, необходимо выполнить следующие действия:

Восстановить последнее полное резервное копирование.
Восстановить все дифференциальные резервные копии, созданные с момента последнего полного резервного копирования.
1.3. Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Да, такой кейс возможен. Он называется активным-пассивным кластером. В активно-пассивном кластере две базы данных находятся в одном кластере. Одна база данных является активной, а другая - пассивной. Активная база данных используется для обработки запросов, а пассивная база данных находится в режиме ожидания.

При поломке активной базы данных система управления кластером автоматически переключает нагрузку на пассивную базу данных. Это обеспечивает бесперебойную работу приложения даже в случае поломки базы данных.

Для реализации активного-пассивного кластера в финансовом учреждении можно использовать следующие инструменты:

Встроенный инструмент кластеризации в базе данных. Например, в MySQL можно использовать инструмент Galera Cluster для создания активного-пассивного кластера.
Специальные инструменты кластеризации. Например, такие инструменты, как Pacemaker, Oracle RAC и другие.



Задание 2. PostgreSQL
2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

Приведите ответ в свободной форме.


Решение:

2.1. Пример команды резервирования данных и восстановления БД (pgdump/pgrestore)

Согласно официальной документации PostgreSQL, для резервирования данных можно использовать команду pgdump. Эта команда создает дамп базы данных в формате SQL.

Для резервирования всех данных в базе данных mydatabase можно использовать следующую команду:

pgdump -h localhost -U postgres -d mydatabase > backup.sql
Эта команда создаст файл backup.sql с дампами всех таблиц в базе данных mydatabase.

Для восстановления базы данных из дампа можно использовать команду pgrestore. Эта команда восстанавливает базу данных из дампа в формате SQL.

Для восстановления базы данных mydatabase из дампа backup.sql можно использовать следующую команду:

pgrestore -h localhost -U postgres -d mydatabase backup.sql
Эта команда восстановит базу данных mydatabase из файла backup.sql.

2.1. Возможно ли автоматизировать этот процесс? Если да, то как?*

Да, процесс резервирования данных и восстановления БД PostgreSQL можно автоматизировать. Для этого можно использовать следующие подходы:

Использование скриптов: можно написать скрипт, который будет выполнять команды pgdump и pgrestore в автоматическом режиме.
Использование систем управления конфигурацией: такие системы, как Ansible, Chef или Puppet, позволяют автоматизировать выполнение команд на удаленных серверах.
Использование сторонних инструментов: существуют сторонние инструменты, которые предназначены для автоматизации резервного копирования баз данных.



Задание 3. MySQL
3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.


Решение:


3.1. Пример команды инкрементного резервного копирования базы данных MySQL

Согласно официальной документации MySQL, для создания инкрементного резервного копирования базы данных можно использовать команду mysqldump с параметром --incremental-backup.

Для резервирования всех данных в базе данных mydatabase с использованием последней полной резервной копии, созданной в 12:00 20 июля 2023 года, можно использовать следующую команду:

mysqldump -h localhost -u root -p mydatabase --incremental-backup --start-datetime=2023-07-20 12:00:00 > incremental.sql

Эта команда создаст файл incremental.sql с дампами всех таблиц в базе данных mydatabase, которые были изменены после 12:00 20 июля 2023 года.

Дополнительные параметры команды mysqldump для инкрементного резервного копирования:

--incremental-basedir: Указывает путь к каталогу, в котором хранятся предыдущие полные и инкрементные резервные копии.
--incremental-history-file: Указывает путь к файлу, в котором хранится информация о предыдущих полных и инкрементных резервных копиях.
--incremental-ignore-table-names: Указывает список таблиц, которые не должны включаться в инкрементное резервное копирование.

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

Приведите ответ в свободной форме.
